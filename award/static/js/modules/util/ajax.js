define(function(v,s,x){var u=v("uri");var t=v("modules/yinyuetai/secret");var q=[];var o=function(b,a){if(typeof(b)==="string"&&typeof(a)==="string"){return b===a}else{if(typeof(b)==="object"&&typeof(a)==="object"){return $.param(b)===$.param(a)}}return false};var m=function(a){var b=new u(a).host();return b!==""&&b!==document.domain};var p=function(d){var e=$('<form method="post"></form>').attr({action:d.url}).appendTo(document.body);var c=d.data||"",a,b={};if(typeof c==="string"){a=c.split("&");$.each(a,function(g,f){f=f.split("=");b[f[0]]=f[1]})}else{b=c}$.each(b,function(g,f){$('<input type="hidden"/>').attr({name:g,value:f}).appendTo(e)});return e};var w=function(b){var a=v("ajaxform");var c=p(b);new a(c,{secretParam:b.secretParam||function(){return[]},onComplete:function(d){$(c.attr("target")).remove();c.remove();if(b.success){b.success(d)}if(_.isFunction(b.complete)){b.complete(d)}else{if(_.isArray(b.complete)){_.each(b.complete,function(e){e(d)})}}}});c.submit()};var n=function(b){for(var c=0,a=q.length;c<a;c++){var e=q[c];if(b.url==e.url&&o(e.data,b.data)){return false}}q.push(b);var f=b.type.toLowerCase();if(m(b.url)){if(f==="post"){w(b);return false}else{b.dataType="jsonp"}}else{if(f==="post"){var d=r(b.secretName,b.secretParam);if(d){if(b.data){if(typeof b.data==="string"){b.data+="&"+$.param(d)}else{b.data=$.extend(b.data,d)}}else{b.data=d}}}}return b};var r=function(b,a){if(t[b]){return t[b](a())}return null};return{ajax:function(d){var a=[function(){q=_.without(q,d)}];if(d.complete){a=a.concat(d.complete)}d.complete=undefined;d=$.extend({timeout:10000,jsonp:"callback",type:"get",secretName:"des",secretParam:function(){return[]},complete:a},d);var c=true;if(d.beforeSend&&typeof d.beforeSend==="function"){c=d.beforeSend()}if(c===false){return}var b=n(d);if(b){return $.ajax(b)}},get:function(d,c,b,a){var e={type:"GET"};d&&(e.url=d);c&&(e.data=c);b&&(e.success=b);a&&(e.dataType=a);return this.ajax(e)},getJSON:function(a,c,b){return this.get(a,c,b,"json")},post:function(d,c,b,a){var e={type:"POST"};d&&(e.url=d);c&&(e.data=c);b&&(e.success=b);a&&(e.dataType=a);return this.ajax(e)}}});