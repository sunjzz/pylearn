define(function(n){var o,p,i;p=n("uri");i=n("modules/yinyuetai/secret");o=Backbone.View.extend({options:{secretName:"des",secretParam:function(){return[]},onRequest:function(){return true},onComplete:function(a){},onError:function(a){}},initialize:function(c){var a,b;a=this.$el;if(a.attr("target")&&$(a.attr("target")).length!=0){return}if(new p(a.attr("action")).host()!==""||a.find("[type=file]").length!==0){b="f"+new Date().getTime();a.attr("target",b);this.iframe=m.call(this,b)}else{l.call(this)}}});function l(){var a,b;a=this.$el;b=this.options;a.submit(function(c){c.preventDefault();k(a,i[b.secretName].apply(window,b.secretParam()));if(b.onRequest.call(a)){$.ajax({type:"POST",url:a.attr("action"),data:a.serialize(),success:function(d){b.onComplete.call(a,d)}})}})}function m(d){var r,a,g,e,f,h,b;r=this.$el;a=this.options;f=a.secretName;h=a.secretParam;$("<input />").attr({type:"hidden",name:"cross_post",value:"1"}).appendTo(r);g=$("<iframe name="+d+"/>").attr({id:d,src:"about:blank"}).css("display","none").appendTo(document.body);g.on("load",function(){var t;try{t=$("#"+d)[0].contentWindow.document.body}catch(q){a.onError.call("上传错误")}b=false;try{var t=$("#"+d)[0].contentWindow.document.body;e=t.innerText;if(!e){e=t.innerHTML}if(e){a.onComplete.call(null,$.parseJSON(e))}}catch(q){a.onComplete.call(null)}});r.on("submit",c);function c(q){q.preventDefault();if(a.onRequest.call(r)){if(b){return false}b=true;r.off("submit");k(r,i[f].apply(window,h()));r.submit();r.on("submit",c)}}return g}function k(a,b){$.each(b,function(d,c){var e=a.find("[name="+d+"]");if(e.length===0){$("<input />").attr({type:"hidden",name:d,value:c}).appendTo(a)}else{e.val(c)}})}function j(a,b){b=b||{};b.el=a;return new o(b)}return j});