/*!
 * jsUri
 * https://github.com/derek-watson/jsUri
 *
 * Copyright 2013, Derek Watson
 * Released under the MIT license.
 *
 * Includes parseUri regular expressions
 * http://blog.stevenlevithan.com/archives/parseuri
 * Copyright 2007, Steven Levithan
 * Released under the MIT license.
 */
(function(j){var k={starts_with_slashes:/^\/+/,ends_with_slashes:/\/+$/,pluses:/\+/g,query_separator:/[&;]/,uri_parser:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/};if(!Array.prototype.forEach){Array.prototype.forEach=function(a,b){for(var c=0,d=this.length;c<d;++c){a.call(b||this,this[c],c,this)}}}function i(a){if(a){a=decodeURIComponent(a);a=a.replace(k.pluses," ")}return a}function l(b){var a=k.uri_parser;var d=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];var e=a.exec(b||"");var c={};d.forEach(function(f,n){c[f]=e[n]||""});return c}function h(n){var c,p,a,f,d,e;var b=[];if(typeof(n)==="undefined"||n===null||n===""){return b}if(n.indexOf("?")===0){n=n.substring(1)}p=n.toString().split(k.query_separator);for(c=0;c<p.length;c++){a=p[c];f=a.indexOf("=");if(f!==0){d=decodeURIComponent(a.substring(0,f));e=decodeURIComponent(a.substring(f+1));b.push(f===-1?[a,null]:[d,e])}}return b}function g(a){this.uriParts=l(a);this.queryPairs=h(this.uriParts.query);this.hasAuthorityPrefixUserPref=null}["protocol","userInfo","host","port","path","anchor"].forEach(function(a){g.prototype[a]=function(b){if(typeof b!=="undefined"){this.uriParts[a]=b}return this.uriParts[a]}});g.prototype.hasAuthorityPrefix=function(a){if(typeof a!=="undefined"){this.hasAuthorityPrefixUserPref=a}if(this.hasAuthorityPrefixUserPref===null){return(this.uriParts.source.indexOf("//")!==-1)}else{return this.hasAuthorityPrefixUserPref}};g.prototype.query=function(a){var c="",d,b;if(typeof a!=="undefined"){this.queryPairs=h(a)}for(d=0;d<this.queryPairs.length;d++){b=this.queryPairs[d];if(c.length>0){c+="&"}if(b[1]===null){c+=b[0]}else{c+=b[0];c+="=";if(b[1]){c+=encodeURIComponent(b[1])}}}return c.length>0?"?"+c:c};g.prototype.getQueryParamValue=function(b){var a,c;for(c=0;c<this.queryPairs.length;c++){a=this.queryPairs[c];if(b===a[0]){return a[1]}}};g.prototype.getQueryParamValues=function(b){var d=[],c,a;for(c=0;c<this.queryPairs.length;c++){a=this.queryPairs[c];if(b===a[0]){d.push(a[1])}}return d};g.prototype.deleteQueryParam=function(c,o){var f=[],d,a,e,b;for(d=0;d<this.queryPairs.length;d++){a=this.queryPairs[d];e=i(a[0])===i(c);b=a[1]===o;if((arguments.length===1&&!e)||(arguments.length===2&&(!e||!b))){f.push(a)}}this.queryPairs=f;return this};g.prototype.addQueryParam=function(b,a,c){if(arguments.length===3&&c!==-1){c=Math.min(c,this.queryPairs.length);this.queryPairs.splice(c,0,[b,a])}else{if(arguments.length>0){this.queryPairs.push([b,a])}}return this};g.prototype.replaceQueryParam=function(b,d,f){var e=-1,c,a;if(arguments.length===3){for(c=0;c<this.queryPairs.length;c++){a=this.queryPairs[c];if(i(a[0])===i(b)&&decodeURIComponent(a[1])===i(f)){e=c;break}}this.deleteQueryParam(b,f).addQueryParam(b,d,e)}else{for(c=0;c<this.queryPairs.length;c++){a=this.queryPairs[c];if(i(a[0])===i(b)){e=c;break}}this.deleteQueryParam(b);this.addQueryParam(b,d,e)}return this};["protocol","hasAuthorityPrefix","userInfo","host","port","path","query","anchor"].forEach(function(b){var a="set"+b.charAt(0).toUpperCase()+b.slice(1);g.prototype[a]=function(c){this[b](c);return this}});g.prototype.scheme=function(){var a="";if(this.protocol()){a+=this.protocol();if(this.protocol().indexOf(":")!==this.protocol().length-1){a+=":"}a+="//"}else{if(this.hasAuthorityPrefix()&&this.host()){a+="//"}}return a};g.prototype.origin=function(){var a=this.scheme();if(a=="file://"){return a+this.uriParts.authority}if(this.userInfo()&&this.host()){a+=this.userInfo();if(this.userInfo().indexOf("@")!==this.userInfo().length-1){a+="@"}}if(this.host()){a+=this.host();if(this.port()){a+=":"+this.port()}}return a};g.prototype.addTrailingSlash=function(){var a=this.path()||"";if(a.substr(-1)!=="/"){this.path(a+"/")}return this};g.prototype.toString=function(){var a,b=this.origin();if(this.path()){a=this.path();if(!(k.ends_with_slashes.test(b)||k.starts_with_slashes.test(a))){b+="/"}else{if(b){b.replace(k.ends_with_slashes,"/")}a=a.replace(k.starts_with_slashes,"/")}b+=a}else{if(this.host()&&(this.query().toString()||this.anchor())){b+="/"}}if(this.query().toString()){if(this.query().toString().indexOf("?")!==0){b+="?"}b+=this.query().toString()}if(this.anchor()){if(this.anchor().indexOf("#")!==0){b+="#"}b+=this.anchor()}return b};g.prototype.clone=function(){return new g(this.toString())};if(typeof define==="function"&&define.amd){define(function(){return g})}else{if(typeof module!=="undefined"&&typeof module.exports!=="undefined"){module.exports=g}else{j.Uri=g}}}(this));